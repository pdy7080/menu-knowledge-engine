# 04. 성수야 × Menu Knowledge Engine 통합 아키텍처

## 1. 관계 설정 원칙

> **성수야 = 엔진의 "첫 번째 고객"이자 "실험장"  
> Menu Knowledge Engine = 독립 가능한 핵심 IP**

**절대 원칙: 엔진은 처음부터 API로 분리한다.**

성수야 안에 기능으로 박아넣는 게 아니라, 성수야가 **첫 번째 API 소비자**가 되는 구조.

이유:
- 성수야가 피봇하거나 변해도 엔진은 독립적으로 성장
- 두 번째 고객(배달앱, 관광 플랫폼) 연결 시 추가 개발 불필요
- 엔진 자체의 가치가 투자자에게 명확히 보임
- 엔진을 별도 사업으로 분리(spin-off) 가능

---

## 2. 시스템 아키텍처

```
┌──────────────────────────────────────────────────────┐
│                    성수야 (프론트)                      │
│   지역 플랫폼 / 가게 소개 / 지도 / 리뷰 / 메뉴 표시     │
│                                                       │
│   [가게 등록] ←── 사장님                               │
│   [메뉴 사진 업로드]                                    │
│        │                                              │
│        │  API Call                                     │
│        ▼                                              │
│   ┌────────────────────────────────────┐              │
│   │   Menu Knowledge Engine (독립 API)  │              │
│   │                                    │              │
│   │   /api/v1/menu/recognize           │ ← OCR + 파싱  │
│   │   /api/v1/menu/identify            │ ← DB매칭/AI탐색│
│   │   /api/v1/menu/translate           │ ← 다국어 변환  │
│   │   /api/v1/menu/explain             │ ← 설명 생성   │
│   │   /api/v1/menu/qr-page             │ ← QR 페이지   │
│   │   /api/v1/graph/similar            │ ← 유사 메뉴   │
│   │   /api/v1/graph/difficulty          │ ← 난이도 점수  │
│   │                                    │              │
│   └──────────────┬─────────────────────┘              │
│                  │                                     │
│                  ▼                                     │
│   [다국어 메뉴 페이지] ←── 외국인 관광객 (QR 스캔)       │
│   [메뉴 난이도 리포트] ←── 사장님 대시보드               │
└──────────────────────────────────────────────────────┘

동시에 (독립 서비스):

┌──────────────────────────────┐
│   외부 클라이언트              │
│                              │
│   • 배달앱 (외국인 모드)       │  ──→ 같은 API
│   • 관광 플랫폼              │  ──→ /api/v1/menu/*
│   • 호텔 체인                │  ──→ /api/v1/graph/*
│   • 지자체 관광 시스템        │
│   • B2C 웹앱 (역방향 흐름)    │
└──────────────────────────────┘
```

---

## 3. 성수야 통합 시 사용자 경험

### 3-1. 가게 사장님 경험

```
1. 성수야에 가게 등록 (기존 흐름 그대로)
2. 메뉴 사진 업로드 (추가 단계)
   → "메뉴판 사진을 올려주세요"
3. 자동 인식 결과 확인
   → "우리가 자동으로 외국인용 메뉴를 만들어드렸어요"
4. [확인] / [수정] / [내 사진으로 교체]
5. QR 코드 자동 생성
   → "이 QR 코드를 매장에 부착하세요"
```

**핵심:** 사장님은 "번역 서비스 쓰겠다"고 생각하지 않음. **"메뉴 사진 올린다"**고만 생각함.

### 3-2. 외국인 관광객 경험 (성수야 앱/웹에서)

```
1. 성수야 지도에서 가게 클릭
2. 언어 선택: English / 日本語 / 中文
3. 메뉴 화면:

   ┌─────────────────────────────────┐
   │ Traditional Pork Bone Soup       │
   │ (할머니뼈해장국)                  │
   │                                 │
   │ Slow-simmered pork bone soup,   │
   │ popular as a hangover cure      │
   │ in Korea.                       │
   │                                 │
   │ 🌶 Spicy  🐷 Pork              │
   │ [📷 Photo]                      │
   │                                 │
   │ ₩9,000                          │
   └─────────────────────────────────┘

4. 탭하면 상세 설명 + 유사 메뉴 추천
5. 발음 듣기 (TTS)
6. "What's similar?" → Knowledge Graph 기반 추천
```

### 3-3. 성수야에 이게 주는 가치

| 가치 | 설명 |
|---|---|
| 콘텐츠 퀄리티 자동 상승 | 가게마다 일관된 품질의 메뉴 설명 |
| 외국인 사용자 유입 | 다국어 = 외국인 접근성 → 신규 사용자층 |
| 데이터 축적 | 외국인 행동 데이터 = 분석/판매 가능 자산 |
| 가게 수 증가 속도 | "외국인 메뉴 무료 제공" = 가게 등록 인센티브 |
| 플랫폼 차별화 | 네이버지도/카카오맵에 없는 기능 |

---

## 4. 성수야를 넘어서는 확장 시나리오

### 시나리오 A: QR 메뉴 독립 서비스

- 성수야 등록 가게 → 외국인용 QR 메뉴 페이지 **자동 제공**
- 이미 메뉴 DB 있음 → 추가 비용 거의 없음
- 성수야 비등록 식당도 별도 QR 서비스로 유료 제공 가능

### 시나리오 B: 관광 동선 설명

- 메뉴 DB가 지역 설명 데이터로 확장:
  - "이 골목에서는 뼈해장국, 순대국 같은 국물 진한 음식이 유명해요"
  - "성수동은 퓨전 한식과 디저트 카페가 많은 지역이에요"
- Knowledge Graph의 `regional_variant` + 지역 데이터 조합

### 시나리오 C: Menu Knowledge Engine 분리 SaaS

- 성수야에서 검증된 엔진
- "성수야에서 쓰는 그 메뉴 AI"라는 스토리 + 실적
- 외부 관광 플랫폼 / 지자체에 API 판매

---

## 5. 기술 스택 제안 (성수야 통합 기준)

```
[프론트엔드]
  성수야 기존: React / Next.js
  다국어 메뉴 페이지: Next.js (i18n)
  사장님 대시보드: 성수야 관리자 확장

[Menu Knowledge Engine API]
  서버: FastAPI (Python)
  OCR: CLOVA OCR API
  LLM: GPT-4o (Identity Discovery) + HyperCLOVA X (한국어 특화)
  벡터 DB: PostgreSQL + pgvector (RAG)
  관계형 DB: PostgreSQL (메뉴 그래프, 수식어 사전)
  캐시: Redis (빈번 조회 메뉴)
  이미지: S3 호환 스토리지

[인프라]
  호스팅: AWS / Naver Cloud
  API Gateway: Kong / AWS API Gateway
  모니터링: Grafana + Prometheus
```

---

## 6. API 설계 초안

```
POST /api/v1/menu/recognize
  Input: 메뉴판 이미지
  Output: OCR 텍스트 + 메뉴명 후보 리스트

POST /api/v1/menu/identify
  Input: 메뉴명 (한국어)
  Output: canonical_id, confidence, explanation, translations

GET /api/v1/menu/{canonical_id}
  Output: 전체 메뉴 개념 객체 (모든 언어, 설명, 이미지)

GET /api/v1/menu/{canonical_id}/translate?lang=en
  Output: 특정 언어 번역 + 설명

POST /api/v1/menu/batch-identify
  Input: 메뉴명 배열
  Output: 일괄 매칭 결과

GET /api/v1/graph/similar/{canonical_id}
  Output: 유사 메뉴 리스트

GET /api/v1/graph/difficulty/{canonical_id}
  Output: 난이도 스코어 + 구성 요소

POST /api/v1/qr/generate
  Input: shop_id + 메뉴 리스트
  Output: QR 코드 이미지 + 다국어 페이지 URL
```
